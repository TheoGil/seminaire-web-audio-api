<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MÃ©tronome</title>
	<style>
		body{
			font-family: sans-serif;
			text-align: center;
			/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#000000+2,000000+100&0+20,0.08+72,0.1+99 */
			background: -moz-radial-gradient(center, ellipse cover,  rgba(0,0,0,0) 2%, rgba(0,0,0,0) 20%, rgba(0,0,0,0.08) 72%, rgba(0,0,0,0.1) 99%, rgba(0,0,0,0.1) 100%); /* FF3.6-15 */
			background: -webkit-radial-gradient(center, ellipse cover,  rgba(0,0,0,0) 2%,rgba(0,0,0,0) 20%,rgba(0,0,0,0.08) 72%,rgba(0,0,0,0.1) 99%,rgba(0,0,0,0.1) 100%); /* Chrome10-25,Safari5.1-6 */
			background: radial-gradient(ellipse at center,  rgba(0,0,0,0) 2%,rgba(0,0,0,0) 20%,rgba(0,0,0,0.08) 72%,rgba(0,0,0,0.1) 99%,rgba(0,0,0,0.1) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00000000', endColorstr='#1a000000',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
		}
		#sequencer{
		    display: inline-block;
		    text-align: left;
		}
		.channels{
			margin-bottom: 20px;
		}
		.settings{
			padding-left: 50px;
			margin-bottom: 20px;
		}
		.pannel{
			display: inline-block;
			vertical-align: top;
		}
		.pannel label{
			display: block;
		}
		.instrument-title{
			display: inline-block;
			width: 50px;
			vertical-align: middle;
		}
		.channel .note{
			position: relative;
			display: inline-block;
			width: 50px;
			min-height: 50px;
			background: #F6F1EB;
			border: 1px black solid;
			border-radius: 5px;

			-webkit-transition: all 0.05s ease-in;
    		transition: all 0.05s ease-in;
		}
		.channel .note.active{
			background: #D3C7BB;
		    -moz-box-shadow: inset 2px 2px 10px 0px rgba(0, 0, 0, .2);
		    -webkit-box-shadow: inset 2px 2px 10px 0px rgba(0, 0, 0, .2);
		    -o-box-shadow: inset 2px 2px 10px 0px rgba(0, 0, 0, .2);
		    box-shadow: inset 2px 2px 10px 0px rgba(0, 0, 0, .2);
		    filter: progid:DXImageTransform.Microsoft.Shadow(color=#656565, Direction=134, Strength=10)
		}
		.channel .note.keyboard{
			background: transparent;
		}
		.channel .note.keyboard.active{
			background: transparent;
			box-shadow: none;
		}
		.channel .note.current:before{
			content: '';
			position: absolute;
			top: -5px;
			right: -5px;
			bottom: -5px;
			left: -5px;
			background: rgba(0, 0, 0, .5);
		}
		.channel canvas{
			display: inline-block;
			width: 50px;
			height: 50px;
		}
		.keyboard .key{
			width: 100%;
			-webkit-transition: all 0.05s ease-in;
    		transition: all 0.05s ease-in;
			height: 15px;
			border: 1px black solid;
			text-align: right;
		}
		.keyboard .key:first-of-type{
			border-radius: 5px 5px 0px 0px;
		}
		.keyboard .key:last-of-type{
			border-radius: 0px 0px 5px 5px ;
		}
		.keyboard .key.active, .keyboard .key.minor.active{
			background: #D3C7BB;;
		}
		.keyboard .key.minor{
			z-index: 10;
		    background: black;
		    vertical-align: top;
		    margin-top: -8px;
		    margin-bottom: -8px;
		    width: 50%;
		}
	</style>
</head>
<body>
	<div id="sequencer">
		<div class="settings">
			<div class="pannel">
				<label>BMP:</label>
				<input type="number" name="bpm" value="115" id="bpm">
				<button id="play">Play</button>
				<button id="stop">Stop</button>
			</div>
		</div>

		<div class="channels">
			<div class="channel" data-instrument="hihat">
				<div class="instrument-title">HIHAT</div>
				<div class="note" data-beat="0"></div>
				<div class="note" data-beat="1"></div>
				<div class="note" data-beat="2"></div>
				<div class="note" data-beat="3"></div>
				<div class="note" data-beat="4"></div>
				<div class="note" data-beat="5"></div>
				<div class="note" data-beat="6"></div>
				<div class="note" data-beat="7"></div>
				<div class="note" data-beat="8"></div>
				<div class="note" data-beat="9"></div>
				<div class="note" data-beat="10"></div>
				<div class="note" data-beat="11"></div>
				<div class="note" data-beat="12"></div>
				<div class="note" data-beat="13"></div>
				<div class="note" data-beat="14"></div>
				<div class="note" data-beat="15"></div>
				<canvas id="canvasWaveformChannel1" width="50" height="50"></canvas>
			</div>
			<div class="channel" data-instrument="snare">
				<div class="instrument-title">CLAP</div>
				<div class="note" data-beat="0"></div>
				<div class="note" data-beat="1"></div>
				<div class="note" data-beat="2"></div>
				<div class="note" data-beat="3"></div>
				<div class="note" data-beat="4"></div>
				<div class="note" data-beat="5"></div>
				<div class="note" data-beat="6"></div>
				<div class="note" data-beat="7"></div>
				<div class="note" data-beat="8"></div>
				<div class="note" data-beat="9"></div>
				<div class="note" data-beat="10"></div>
				<div class="note" data-beat="11"></div>
				<div class="note" data-beat="12"></div>
				<div class="note" data-beat="13"></div>
				<div class="note" data-beat="14"></div>
				<div class="note" data-beat="15"></div>
				<canvas id="canvasWaveformChannel2" width="50" height="50"></canvas>
			</div>
			<div class="channel" data-instrument="kick">
				<div class="instrument-title">KICK</div>
				<div class="note" data-beat="0"></div>
				<div class="note" data-beat="1"></div>
				<div class="note" data-beat="2"></div>
				<div class="note" data-beat="3"></div>
				<div class="note" data-beat="4"></div>
				<div class="note" data-beat="5"></div>
				<div class="note" data-beat="6"></div>
				<div class="note" data-beat="7"></div>
				<div class="note" data-beat="8"></div>
				<div class="note" data-beat="9"></div>
				<div class="note" data-beat="10"></div>
				<div class="note" data-beat="11"></div>
				<div class="note" data-beat="12"></div>
				<div class="note" data-beat="13"></div>
				<div class="note" data-beat="14"></div>
				<div class="note" data-beat="15"></div>
				<canvas id="canvasWaveformChannel3" width="50" height="50"></canvas>
			</div>
			<div class="channel" data-instrument="bass">
				<div class="instrument-title">BASS</div>
				<div class="note keyboard" data-beat="0">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="1">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="2">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="3">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="4">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="5">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="6">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="7">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="8">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="9">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="10">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="11">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="12">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="13">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="14">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<div class="note keyboard" data-beat="15">
					<div class="key" data-freq="61.7"></div>
					<div class="key minor" data-freq="58.3"></div>
					<div class="key" data-freq="55"></div>
					<div class="key minor" data-freq="51.9"></div>
					<div class="key" data-freq="49"></div>
					<div class="key" data-freq="46.2"></div>
					<div class="key minor" data-freq="43.7"></div>
					<div class="key" data-freq="41.2"></div>
					<div class="key minor" data-freq="38.9"></div>
					<div class="key" data-freq="36.7"></div>
					<div class="key minor" data-freq="34.6"></div>
					<div class="key" data-freq="32.7"></div>
				</div>
				<canvas id="canvasWaveformChannel4" width="50" height="50"></canvas>
			</div>
		</div>
		
		<div class="settings">

			<div class="pannel">
				HIHAT SETTINGS
				<label for="">Release
					<input class="instrument-setting" type="range" min="0.1" max="2" value="0.5" step="0.1"
					   data-instrument="hihat" data-parameter="decay">
				</label>
			</div>

			<div class="pannel">
				SNARE SETTINGS
				<label for="">OSC Frequency
					<input class="instrument-setting" type="range" min="1" max="1000" value="200" 
					   data-instrument="snare" data-parameter="frequency">
				</label>
				<label for="">Release
					<input class="instrument-setting" type="range" min="0.1" max="2" value="0.2" step="0.1" 
					   data-instrument="snare" data-parameter="decay">
				</label>
			</div>

			<div class="pannel">
				KICK SETTINGS
				<label for="">OSC start frequency
					<input class="instrument-setting" type="range" min="1" max="1000" value="130.8" 
					   data-instrument="kick" data-parameter="startFreq">
				</label>
				<label for="">OSC end frequency
					<input class="instrument-setting" type="range" min="1" max="1000" value="1" 
					   data-instrument="kick" data-parameter="endFreq">
				</label>
				<label for="">OSC pitch decay
					<input class="instrument-setting" type="range" min="0.01" max="2" value="0.01" step="0.1"
					   data-instrument="kick" data-parameter="pitchDecay">
				</label>
				<label for="">Release
					<input class="instrument-setting" type="range" min="0.1" max="2" value="0.2" step="0.1" 
					   data-instrument="kick" data-parameter="release">
				</label>
			</div>

			<div class="pannel">
				BASS SETTINGS
				<label for="">
					Release
					<input class="instrument-setting" type="range"  min="0" max="1" step="0.1" value="500" 
						data-instrument="bass" data-parameter="release">
				</label>
				<label for="">
					Filter Frequency
					<input class="instrument-setting" type="range"  min="100" max="20000" step="100" value="18000"
						data-instrument="bass" data-parameter="filterFreq">
				</label>
			</div>

			<div class="pannel">
				MASTER FILTER SETTINGS
				<div>
					<label>
						Frequency
						<input id="master-filter-freq" type="range"  min="1" max="20000" step="100" value="20000">
					</label>
				</div>
				<div>
					<label>
						Resonance
						<input id="master-filter-q" type="range"  min="1" max="25" step="1" value="1">
					</label>
				</div>
				<div>
					<label>
						Type
						<select id="master-filter-type">
							<option value="lowpass">Lowpass</option>
							<option value="highpass">Highpass</option>
							<option value="bandpass">Bandpass</option>
						</select>
					</label>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<script src="src/js/scheduler.js"></script>
<script src="src/js/instruments.js"></script>
<script>

	var audioContext, masterFilter, bpm;

	function draw(audioContext){
		visualize(instruments['hihat'].analyser, instruments['hihat'].canvas, instruments['hihat'].canvasCtx);
		visualize(instruments['snare'].analyser, instruments['snare'].canvas, instruments['snare'].canvasCtx);
		visualize(instruments['kick'].analyser, instruments['kick'].canvas, instruments['kick'].canvasCtx);
		visualize(instruments['bass'].analyser, instruments['bass'].canvas, instruments['bass'].canvasCtx);
		requestAnimationFrame(draw);
	}

	function visualize(visualizer, canvas, canvasCtx){
		var data = new Uint8Array(visualizer.fftSize);
		visualizer.getByteTimeDomainData(data);
		
		canvasCtx.fillStyle = 'rgb(255, 255, 250)';
		canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

		canvasCtx.lineWidth = 2;
		canvasCtx.strokeStyle = 'rgb(0, 0, 0)';

		canvasCtx.beginPath();

		var sliceWidth = canvas.width * 1.0 / visualizer.fftSize;
		var x = 0;

		var total = 0;

		for(var i = 0; i < visualizer.fftSize; i++) {
			var v =  data[i] / 128;
			var y = v * canvas.height * .5;

			if(i === 0) {
				canvasCtx.moveTo(x, y);
			} else {
				canvasCtx.lineTo(x, y);
			}

			x += sliceWidth;

			total += v;
		}

		canvasCtx.lineTo(canvas.width, canvas.height/2);
		canvasCtx.stroke();
	}

	//requestAnimationFrame(draw);

	var whiteNoiseBuffer = null;
	var clapSampleBuffer = null;

	function init(){
		registerListeners();

		audioContext = new AudioContext() || new webkitAudioContext();

		masterFilter = audioContext.createBiquadFilter();
		masterFilter = audioContext.createBiquadFilter();
		masterFilter.connect(audioContext.destination);

		bpm = 110;

		prepareBuffers();
		instruments['hihat'].init();
		instruments['snare'].init();
		instruments['kick'].init();
		instruments['bass'].init();
	}

	function registerListeners(){

		$('#play').click(function(){
			scheduler.start();
		});

		$('#stop').click(function(){
			scheduler.stop();
		});

		$('#master-filter-freq').on('input', function(){
			masterFilter.frequency.value = parseInt($(this).val());
		});

		$('#master-filter-q').on('input', function(){
			masterFilter.Q.value = parseFloat($(this).val());
		});

		$('#master-filter-type').on('change', function(){
			masterFilter.type = $(this).val();
		});

		$('#bpm').on('change', function(){
			bpm = $(this).val();
		});

		$('.note').click(function(){
			$(this).toggleClass('active');
		});

		$('.note').on('click', '.key', function(e){
			e.stopPropagation();
			if($(this).hasClass('active')){
				$(this).removeClass('active');
				$(this).closest('.note').removeClass('active');
			} else {
				$(this).closest('.keyboard').find('.key.active').removeClass('active');
				$(this).addClass('active');
				$(this).closest('.note').addClass('active');
			}
		});

		$('.settings .instrument-setting').on('input', function(){
			var instrument = $(this).data('instrument');
			var parameter  = $(this).data('parameter');
			var newValue   = parseFloat( $(this).val() );
			instruments[instrument][parameter] = newValue;
		});
	}

	prepareBuffers = function(){
		whiteNoiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate, audioContext.sampleRate);
		var output = whiteNoiseBuffer.getChannelData(0);
		console.log(output);
		for (var i = 0; i < audioContext.sampleRate; i++) {
			output[i] = Math.random() * 2 - 1;
		}
	}; // Load our samples and create a buffer of white noise

	init();
</script>
</html>